{"ast":null,"code":"'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\n/* global OT */\n/**\n * Dependencies\n */\nvar util = require('./util');\nvar State = require('./state').default;\nvar accPackEvents = require('./events');\nvar Communication = require('./communication').default;\nvar OpenTokSDK = require('./sdk-wrapper/sdkWrapper');\nvar _require = require('./errors'),\n  CoreError = _require.CoreError;\nvar _require2 = require('./logging'),\n  message = _require2.message,\n  Analytics = _require2.Analytics,\n  logAction = _require2.logAction,\n  logVariation = _require2.logVariation;\n\n/**\n * Helper methods\n */\n\nvar dom = util.dom,\n  path = util.path,\n  pathOr = util.pathOr,\n  properCase = util.properCase;\n\n/**\n * Ensure that we have the required credentials\n * @param {Object} credentials\n * @param {String} credentials.apiKey\n * @param {String} credentials.sessionId\n * @param {String} credentials.token\n */\n\nvar validateCredentials = function validateCredentials() {\n  var credentials = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var required = ['apiKey', 'sessionId', 'token'];\n  required.forEach(function (credential) {\n    if (!credentials[credential]) {\n      throw new CoreError(credential + ' is a required credential', 'invalidParameters');\n    }\n  });\n};\nvar AccCore = function AccCore(options) {\n  _classCallCheck(this, AccCore);\n  _initialiseProps.call(this);\n\n  // Options/credentials validation\n  if (!options) {\n    throw new CoreError('Missing options required for initialization', 'invalidParameters');\n  }\n  var credentials = options.credentials;\n  validateCredentials(options.credentials);\n  this.name = options.name;\n\n  // Init analytics\n  this.applicationName = options.applicationName;\n  this.analytics = new Analytics(window.location.origin, credentials.sessionId, null, credentials.apiKey);\n  this.analytics.log(logAction.init, logVariation.attempt);\n\n  // Create session, setup state\n  var sessionProps = options.largeScale ? {\n    connectionEventsSuppressed: true\n  } : undefined;\n  this.session = OT.initSession(credentials.apiKey, credentials.sessionId, sessionProps);\n  this.internalState = new State();\n  this.internalState.setSession(this.session);\n  this.internalState.setCredentials(credentials);\n  this.internalState.setOptions(options);\n\n  // Individual accelerator packs\n  this.communication = null;\n  this.textChat = null;\n  this.screenSharing = null;\n  this.annotation = null;\n  this.archiving = null;\n\n  // Create internal event listeners\n  this.createEventListeners(this.session, options);\n  this.analytics.log(logAction.init, logVariation.success);\n}\n\n// OpenTok SDK Wrapper\n\n// Expose utility methods\n\n/**\n * Get access to an accelerator pack\n * @param {String} packageName - textChat, screenSharing, annotation, or archiving\n * @returns {Object} The instance of the accelerator pack\n */\n\n/** Eventing */\n\n/**\n * Register events that can be listened to be other components/modules\n * @param {array | string} events - A list of event names. A single event may\n * also be passed as a string.\n */\n\n/**\n * Register a callback for a specific event or pass an object with\n * with event => callback key/value pairs to register listeners for\n * multiple events.\n * @param {String | Object} event - The name of the event\n * @param {Function} callback\n */\n\n/**\n * Remove a callback for a specific event.  If no parameters are passed,\n * all event listeners will be removed.\n * @param {String} event - The name of the event\n * @param {Function} callback\n */\n\n/**\n * Trigger an event and fire all registered callbacks\n * @param {String} event - The name of the event\n * @param {*} data - Data to be passed to callback functions\n */\n\n/**\n * Get the current OpenTok session object\n * @returns {Object}\n */\n\n/**\n * Returns the current OpenTok session credentials\n * @returns {Object}\n */\n\n/**\n * Returns the options used for initialization\n * @returns {Object}\n */\n\n/**\n * Connect to the session\n * @returns {Promise} <resolve: -, reject: Error>\n */\n\n/**\n * Disconnect from the session\n * @returns {Promise} <resolve: -, reject: Error>\n */\n\n/**\n * Force a remote connection to leave the session\n * @param {Object} connection\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n/**\n * Start publishing video and subscribing to streams\n * @param {Object} publisherProps - https://goo.gl/0mL0Eo\n * @returns {Promise} <resolve: State + Publisher, reject: Error>\n */\n\n/**\n * Stop all publishing un unsubscribe from all streams\n * @returns {void}\n */\n\n/**\n * Start publishing video and subscribing to streams\n * @returns {Object} The internal state of the core session\n */\n\n/**\n * Manually subscribe to a stream\n * @param {Object} stream - An OpenTok stream\n * @param {Object} [subscriberProperties] - https://tokbox.com/developer/sdks/js/reference/Session.html#subscribe\n * @param {Boolean} [networkTest] - Subscribing to our own publisher as part of a network test?\n * @returns {Promise} <resolve: Subscriber, reject: Error>\n */\n\n/**\n * Manually unsubscribe from a stream\n * @param {Object} subscriber - An OpenTok subscriber object\n * @returns {Promise} <resolve: void, reject: Error>\n */\n\n/**\n * Force the publisher of a stream to stop publishing the stream\n * @param {Object} stream\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n/**\n * Get the local publisher object for a stream\n * @param {Object} stream - An OpenTok stream object\n * @returns {Object} - The publisher object\n */\n\n/**\n * Get the local subscriber objects for a stream\n * @param {Object} stream - An OpenTok stream object\n * @returns {Array} - An array of subscriber object\n */\n\n/**\n * Send a signal using the OpenTok signaling apiKey\n * @param {String} type\n * @param {*} [data]\n * @param {Object} [to] - An OpenTok connection object\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n/**\n * Enable or disable local audio\n * @param {Boolean} enable\n */\n\n/**\n * Enable or disable local video\n * @param {Boolean} enable\n */\n\n/**\n * Enable or disable remote audio\n * @param {String} id - Subscriber id\n * @param {Boolean} enable\n */\n\n/**\n * Enable or disable remote video\n * @param {String} id - Subscriber id\n * @param {Boolean} enable\n */;\nObject.defineProperty(AccCore, 'OpenTokSDK', {\n  enumerable: true,\n  writable: true,\n  value: OpenTokSDK\n});\nObject.defineProperty(AccCore, 'util', {\n  enumerable: true,\n  writable: true,\n  value: util\n});\nvar _initialiseProps = function _initialiseProps() {\n  var _this = this;\n  Object.defineProperty(this, 'getAccPack', {\n    enumerable: true,\n    writable: true,\n    value: function value(packageName) {\n      var analytics = _this.analytics,\n        textChat = _this.textChat,\n        screenSharing = _this.screenSharing,\n        annotation = _this.annotation,\n        archiving = _this.archiving;\n      analytics.log(logAction.getAccPack, logVariation.attempt);\n      var packages = {\n        textChat: textChat,\n        screenSharing: screenSharing,\n        annotation: annotation,\n        archiving: archiving\n      };\n      analytics.log(logAction.getAccPack, logVariation.success);\n      return packages[packageName];\n    }\n  });\n  Object.defineProperty(this, 'registerEvents', {\n    enumerable: true,\n    writable: true,\n    value: function value(events) {\n      var eventListeners = _this.eventListeners;\n      var eventList = Array.isArray(events) ? events : [events];\n      eventList.forEach(function (event) {\n        if (!eventListeners[event]) {\n          eventListeners[event] = new Set();\n        }\n      });\n    }\n  });\n  Object.defineProperty(this, 'on', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, callback) {\n      var eventListeners = _this.eventListeners,\n        on = _this.on;\n      // analytics.log(logAction.on, logVariation.attempt);\n\n      if ((typeof event === 'undefined' ? 'undefined' : _typeof(event)) === 'object') {\n        Object.keys(event).forEach(function (eventName) {\n          on(eventName, event[eventName]);\n        });\n        return;\n      }\n      var eventCallbacks = eventListeners[event];\n      if (!eventCallbacks) {\n        message(event + ' is not a registered event.');\n        // analytics.log(logAction.on, logVariation.fail);\n      } else {\n        eventCallbacks.add(callback);\n        // analytics.log(logAction.on, logVariation.success);\n      }\n    }\n  });\n  Object.defineProperty(this, 'off', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, callback) {\n      var eventListeners = _this.eventListeners;\n      // analytics.log(logAction.off, logVariation.attempt);\n\n      if (!event && !callback) {\n        Object.keys(eventListeners).forEach(function (eventType) {\n          eventListeners[eventType].clear();\n        });\n      } else {\n        var eventCallbacks = eventListeners[event];\n        if (!eventCallbacks) {\n          // analytics.log(logAction.off, logVariation.fail);\n          message(event + ' is not a registered event.');\n        } else {\n          eventCallbacks.delete(callback);\n          // analytics.log(logAction.off, logVariation.success);\n        }\n      }\n    }\n  });\n  Object.defineProperty(this, 'triggerEvent', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, data) {\n      var eventListeners = _this.eventListeners,\n        registerEvents = _this.registerEvents;\n      var eventCallbacks = eventListeners[event];\n      if (!eventCallbacks) {\n        registerEvents(event);\n        message(event + ' has been registered as a new event.');\n      } else {\n        eventCallbacks.forEach(function (callback) {\n          return callback(data, event);\n        });\n      }\n    }\n  });\n  Object.defineProperty(this, 'getSession', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getSession();\n    }\n  });\n  Object.defineProperty(this, 'getCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getCredentials();\n    }\n  });\n  Object.defineProperty(this, 'getOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getOptions();\n    }\n  });\n  Object.defineProperty(this, 'createEventListeners', {\n    enumerable: true,\n    writable: true,\n    value: function value(session, options) {\n      _this.eventListeners = {};\n      var registerEvents = _this.registerEvents,\n        internalState = _this.internalState,\n        triggerEvent = _this.triggerEvent,\n        on = _this.on,\n        getSession = _this.getSession;\n      Object.keys(accPackEvents).forEach(function (type) {\n        return registerEvents(accPackEvents[type]);\n      });\n\n      /**\n       * If using screen sharing + annotation in an external window, the screen sharing\n       * package will take care of calling annotation.start() and annotation.linkCanvas()\n       */\n      var usingAnnotation = path('screenSharing.annotation', options);\n      var internalAnnotation = usingAnnotation && !path('screenSharing.externalWindow', options);\n\n      /**\n       * Wrap session events and update internalState when streams are created\n       * or destroyed\n       */\n      accPackEvents.session.forEach(function (eventName) {\n        session.on(eventName, function (event) {\n          if (eventName === 'streamCreated') {\n            internalState.addStream(event.stream);\n          }\n          if (eventName === 'streamDestroyed') {\n            internalState.removeStream(event.stream);\n          }\n          triggerEvent(eventName, event);\n        });\n      });\n      if (usingAnnotation) {\n        on('subscribeToScreen', function (_ref) {\n          var subscriber = _ref.subscriber;\n          _this.annotation.start(getSession()).then(function () {\n            var absoluteParent = dom.query(path('annotation.absoluteParent.subscriber', options));\n            var linkOptions = absoluteParent ? {\n              absoluteParent: absoluteParent\n            } : null;\n            _this.annotation.linkCanvas(subscriber, subscriber.element.parentElement, linkOptions);\n          });\n        });\n        on('unsubscribeFromScreen', function () {\n          _this.annotation.end();\n        });\n      }\n      on('startScreenSharing', function (publisher) {\n        internalState.addPublisher('screen', publisher);\n        triggerEvent('startScreenShare', Object.assign({}, {\n          publisher: publisher\n        }, internalState.getPubSub()));\n        if (internalAnnotation) {\n          _this.annotation.start(getSession()).then(function () {\n            var absoluteParent = dom.query(path('annotation.absoluteParent.publisher', options));\n            var linkOptions = absoluteParent ? {\n              absoluteParent: absoluteParent\n            } : null;\n            _this.annotation.linkCanvas(publisher, publisher.element.parentElement, linkOptions);\n          });\n        }\n      });\n      on('endScreenSharing', function (publisher) {\n        // delete publishers.screen[publisher.id];\n        internalState.removePublisher('screen', publisher);\n        triggerEvent('endScreenShare', internalState.getPubSub());\n        if (usingAnnotation) {\n          _this.annotation.end();\n        }\n      });\n    }\n  });\n  Object.defineProperty(this, 'setupExternalAnnotation', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.annotation.start(_this.getSession(), {\n        screensharing: true\n      });\n    }\n  });\n  Object.defineProperty(this, 'linkAnnotation', {\n    enumerable: true,\n    writable: true,\n    value: function value(pubSub, annotationContainer, externalWindow) {\n      var annotation = _this.annotation,\n        internalState = _this.internalState;\n      annotation.linkCanvas(pubSub, annotationContainer, {\n        externalWindow: externalWindow\n      });\n      if (externalWindow) {\n        // Add subscribers to the external window\n        var streams = internalState.getStreams();\n        var cameraStreams = Object.keys(streams).reduce(function (acc, streamId) {\n          var stream = streams[streamId];\n          return stream.videoType === 'camera' || stream.videoType === 'sip' ? acc.concat(stream) : acc;\n        }, []);\n        cameraStreams.forEach(annotation.addSubscriberToExternalWindow);\n      }\n    }\n  });\n  Object.defineProperty(this, 'initPackages', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n        getSession = _this.getSession,\n        getOptions = _this.getOptions,\n        internalState = _this.internalState;\n      var on = _this.on,\n        registerEvents = _this.registerEvents,\n        setupExternalAnnotation = _this.setupExternalAnnotation,\n        triggerEvent = _this.triggerEvent,\n        linkAnnotation = _this.linkAnnotation;\n      analytics.log(logAction.initPackages, logVariation.attempt);\n      var session = getSession();\n      var options = getOptions();\n      /**\n       * Try to require a package.  If 'require' is unavailable, look for\n       * the package in global scope.  A switch ttatement is used because\n       * webpack and Browserify aren't able to resolve require statements\n       * that use variable names.\n       * @param {String} packageName - The name of the npm package\n       * @param {String} globalName - The name of the package if exposed on global/window\n       * @returns {Object}\n       */\n      var optionalRequire = function optionalRequire(packageName, globalName) {\n        var result = void 0;\n        /* eslint-disable global-require, import/no-extraneous-dependencies, import/no-unresolved */\n        try {\n          switch (packageName) {\n            case 'opentok-text-chat':\n              result = require('opentok-text-chat');\n              break;\n            case 'opentok-screen-sharing':\n              result = require('opentok-screen-sharing');\n              break;\n            case 'opentok-annotation':\n              result = require('opentok-annotation');\n              break;\n            case 'opentok-archiving':\n              result = require('opentok-archiving');\n              break;\n            default:\n              break;\n          }\n          /* eslint-enable global-require */\n        } catch (error) {\n          result = window[globalName];\n        }\n        if (!result) {\n          analytics.log(logAction.initPackages, logVariation.fail);\n          throw new CoreError('Could not load ' + packageName, 'missingDependency');\n        }\n        return result;\n      };\n      var availablePackages = {\n        textChat: function textChat() {\n          return optionalRequire('opentok-text-chat', 'TextChatAccPack');\n        },\n        screenSharing: function screenSharing() {\n          return optionalRequire('opentok-screen-sharing', 'ScreenSharingAccPack');\n        },\n        annotation: function annotation() {\n          return optionalRequire('opentok-annotation', 'AnnotationAccPack');\n        },\n        archiving: function archiving() {\n          return optionalRequire('opentok-archiving', 'ArchivingAccPack');\n        }\n      };\n      var packages = {};\n      (path('packages', options) || []).forEach(function (acceleratorPack) {\n        if (availablePackages[acceleratorPack]) {\n          // eslint-disable-next-line no-param-reassign\n          packages[properCase(acceleratorPack)] = availablePackages[acceleratorPack]();\n        } else {\n          message(acceleratorPack + ' is not a valid accelerator pack');\n        }\n      });\n\n      /**\n       * Get containers for streams, controls, and the chat widget\n       */\n      var getDefaultContainer = function getDefaultContainer(pubSub) {\n        return document.getElementById(pubSub + 'Container');\n      };\n      var getContainerElements = function getContainerElements() {\n        // Need to use path to check for null values\n        var controls = pathOr('#videoControls', 'controlsContainer', options);\n        var chat = pathOr('#chat', 'textChat.container', options);\n        var stream = pathOr(getDefaultContainer, 'streamContainers', options);\n        return {\n          stream: stream,\n          controls: controls,\n          chat: chat\n        };\n      };\n      /** *** *** *** *** */\n\n      /**\n       * Return options for the specified package\n       * @param {String} packageName\n       * @returns {Object}\n       */\n      var packageOptions = function packageOptions(packageName) {\n        /**\n         * Methods to expose to accelerator packs\n         */\n        var accPack = {\n          registerEventListener: on,\n          // Legacy option\n          on: on,\n          registerEvents: registerEvents,\n          triggerEvent: triggerEvent,\n          setupExternalAnnotation: setupExternalAnnotation,\n          linkAnnotation: linkAnnotation\n        };\n\n        /**\n         * If options.controlsContainer/containers.controls is null,\n         * accelerator packs should not append their controls.\n         */\n        var containers = getContainerElements();\n        var appendControl = !!containers.controls;\n        var controlsContainer = containers.controls; // Legacy option\n        var streamContainers = containers.stream;\n        var baseOptions = {\n          session: session,\n          core: accPack,\n          accPack: accPack,\n          controlsContainer: controlsContainer,\n          appendControl: appendControl,\n          streamContainers: streamContainers\n        };\n        switch (packageName) {\n          /* beautify ignore:start */\n          case 'communication':\n            {\n              return Object.assign({}, baseOptions, {\n                state: internalState,\n                analytics: analytics\n              }, options.communication);\n            }\n          case 'textChat':\n            {\n              var textChatOptions = {\n                textChatContainer: path('textChat.container', options),\n                waitingMessage: path('textChat.waitingMessage', options),\n                sender: {\n                  alias: path('textChat.name', options)\n                },\n                alwaysOpen: path('textChat.alwaysOpen', options)\n              };\n              return Object.assign({}, baseOptions, textChatOptions);\n            }\n          case 'screenSharing':\n            {\n              var screenSharingContainer = {\n                screenSharingContainer: streamContainers\n              };\n              return Object.assign({}, baseOptions, screenSharingContainer, options.screenSharing);\n            }\n          case 'annotation':\n            {\n              return Object.assign({}, baseOptions, options.annotation);\n            }\n          case 'archiving':\n            {\n              return Object.assign({}, baseOptions, options.archiving);\n            }\n          default:\n            return {};\n          /* beautify ignore:end */\n        }\n      };\n\n      /** Create instances of each package */\n      // eslint-disable-next-line global-require,import/no-extraneous-dependencies\n\n      _this.communication = new Communication(packageOptions('communication'));\n      _this.textChat = packages.TextChat ? new packages.TextChat(packageOptions('textChat')) : null;\n      _this.screenSharing = packages.ScreenSharing ? new packages.ScreenSharing(packageOptions('screenSharing')) : null;\n      _this.annotation = packages.Annotation ? new packages.Annotation(packageOptions('annotation')) : null;\n      _this.archiving = packages.Archiving ? new packages.Archiving(packageOptions('archiving')) : null;\n      analytics.log(logAction.initPackages, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'connect', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n        getSession = _this.getSession,\n        initPackages = _this.initPackages,\n        triggerEvent = _this.triggerEvent,\n        getCredentials = _this.getCredentials;\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.connect, logVariation.attempt);\n        var session = getSession();\n        var _getCredentials = getCredentials(),\n          token = _getCredentials.token;\n        session.connect(token, function (error) {\n          if (error) {\n            message(error);\n            analytics.log(logAction.connect, logVariation.fail);\n            return reject(error);\n          }\n          var sessionId = session.sessionId,\n            apiKey = session.apiKey;\n          analytics.update(sessionId, path('connection.connectionId', session), apiKey);\n          analytics.log(logAction.connect, logVariation.success);\n          initPackages();\n          triggerEvent('connected', session);\n          return resolve({\n            connections: session.connections.length()\n          });\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'disconnect', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n        getSession = _this.getSession,\n        internalState = _this.internalState;\n      analytics.log(logAction.disconnect, logVariation.attempt);\n      getSession().disconnect();\n      internalState.reset();\n      analytics.log(logAction.disconnect, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'forceDisconnect', {\n    enumerable: true,\n    writable: true,\n    value: function value(connection) {\n      var analytics = _this.analytics,\n        getSession = _this.getSession;\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.forceDisconnect, logVariation.attempt);\n        getSession().forceDisconnect(connection, function (error) {\n          if (error) {\n            analytics.log(logAction.forceDisconnect, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.forceDisconnect, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'startCall', {\n    enumerable: true,\n    writable: true,\n    value: function value(publisherProps) {\n      return _this.communication.startCall(publisherProps);\n    }\n  });\n  Object.defineProperty(this, 'endCall', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.communication.endCall();\n    }\n  });\n  Object.defineProperty(this, 'state', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.all();\n    }\n  });\n  Object.defineProperty(this, 'subscribe', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream, subscriberProperties) {\n      var networkTest = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      return _this.communication.subscribe(stream, subscriberProperties, networkTest);\n    }\n  });\n  Object.defineProperty(this, 'unsubscribe', {\n    enumerable: true,\n    writable: true,\n    value: function value(subscriber) {\n      return _this.communication.unsubscribe(subscriber);\n    }\n  });\n  Object.defineProperty(this, 'forceUnpublish', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      var analytics = _this.analytics,\n        getSession = _this.getSession;\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.forceUnpublish, logVariation.attempt);\n        getSession().forceUnpublish(stream, function (error) {\n          if (error) {\n            analytics.log(logAction.forceUnpublish, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.forceUnpublish, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'getPublisherForStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      return _this.getSession().getPublisherForStream(stream);\n    }\n  });\n  Object.defineProperty(this, 'getSubscribersForStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      return _this.getSession().getSubscribersForStream(stream);\n    }\n  });\n  Object.defineProperty(this, 'signal', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, data, to) {\n      var analytics = _this.analytics,\n        getSession = _this.getSession;\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.signal, logVariation.attempt);\n        var session = getSession();\n        var signalObj = Object.assign({}, type ? {\n          type: type\n        } : null, data ? {\n          data: JSON.stringify(data)\n        } : null, to ? {\n          to: to\n        } : null // eslint-disable-line comma-dangle\n        );\n        session.signal(signalObj, function (error) {\n          if (error) {\n            analytics.log(logAction.signal, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.signal, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'toggleLocalAudio', {\n    enumerable: true,\n    writable: true,\n    value: function value(enable) {\n      var analytics = _this.analytics,\n        internalState = _this.internalState,\n        communication = _this.communication;\n      analytics.log(logAction.toggleLocalAudio, logVariation.attempt);\n      var _internalState$getPub = internalState.getPubSub(),\n        publishers = _internalState$getPub.publishers;\n      var toggleAudio = function toggleAudio(id) {\n        return communication.enableLocalAV(id, 'audio', enable);\n      };\n      Object.keys(publishers.camera).forEach(toggleAudio);\n      analytics.log(logAction.toggleLocalAudio, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleLocalVideo', {\n    enumerable: true,\n    writable: true,\n    value: function value(enable) {\n      var analytics = _this.analytics,\n        internalState = _this.internalState,\n        communication = _this.communication;\n      analytics.log(logAction.toggleLocalVideo, logVariation.attempt);\n      var _internalState$getPub2 = internalState.getPubSub(),\n        publishers = _internalState$getPub2.publishers;\n      var toggleVideo = function toggleVideo(id) {\n        return communication.enableLocalAV(id, 'video', enable);\n      };\n      Object.keys(publishers.camera).forEach(toggleVideo);\n      analytics.log(logAction.toggleLocalVideo, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleRemoteAudio', {\n    enumerable: true,\n    writable: true,\n    value: function value(id, enable) {\n      var analytics = _this.analytics,\n        communication = _this.communication;\n      analytics.log(logAction.toggleRemoteAudio, logVariation.attempt);\n      communication.enableRemoteAV(id, 'audio', enable);\n      analytics.log(logAction.toggleRemoteAudio, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleRemoteVideo', {\n    enumerable: true,\n    writable: true,\n    value: function value(id, enable) {\n      var analytics = _this.analytics,\n        communication = _this.communication;\n      analytics.log(logAction.toggleRemoteVideo, logVariation.attempt);\n      communication.enableRemoteAV(id, 'video', enable);\n      analytics.log(logAction.toggleRemoteVideo, logVariation.success);\n    }\n  });\n};\nif (global === window) {\n  window.AccCore = AccCore;\n}\nmodule.exports = AccCore;","map":{"version":3,"names":["_typeof","Symbol","iterator","obj","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","util","require","State","default","accPackEvents","Communication","OpenTokSDK","_require","CoreError","_require2","message","Analytics","logAction","logVariation","dom","path","pathOr","properCase","validateCredentials","credentials","arguments","length","undefined","required","forEach","credential","AccCore","options","_initialiseProps","call","name","applicationName","analytics","window","location","origin","sessionId","apiKey","log","init","attempt","sessionProps","largeScale","connectionEventsSuppressed","session","OT","initSession","internalState","setSession","setCredentials","setOptions","communication","textChat","screenSharing","annotation","archiving","createEventListeners","success","Object","defineProperty","enumerable","writable","value","_this","packageName","getAccPack","packages","events","eventListeners","eventList","Array","isArray","event","Set","callback","on","keys","eventName","eventCallbacks","add","eventType","clear","delete","data","registerEvents","getSession","getCredentials","getOptions","triggerEvent","type","usingAnnotation","internalAnnotation","addStream","stream","removeStream","_ref","subscriber","start","then","absoluteParent","query","linkOptions","linkCanvas","element","parentElement","end","publisher","addPublisher","assign","getPubSub","removePublisher","screensharing","pubSub","annotationContainer","externalWindow","streams","getStreams","cameraStreams","reduce","acc","streamId","videoType","concat","addSubscriberToExternalWindow","setupExternalAnnotation","linkAnnotation","initPackages","optionalRequire","globalName","result","error","fail","availablePackages","acceleratorPack","getDefaultContainer","document","getElementById","getContainerElements","controls","chat","packageOptions","accPack","registerEventListener","containers","appendControl","controlsContainer","streamContainers","baseOptions","core","state","textChatOptions","textChatContainer","waitingMessage","sender","alias","alwaysOpen","screenSharingContainer","TextChat","ScreenSharing","Annotation","Archiving","Promise","resolve","reject","connect","_getCredentials","token","update","connections","disconnect","reset","connection","forceDisconnect","publisherProps","startCall","endCall","all","subscriberProperties","networkTest","subscribe","unsubscribe","forceUnpublish","getPublisherForStream","getSubscribersForStream","to","signal","signalObj","JSON","stringify","enable","toggleLocalAudio","_internalState$getPub","publishers","toggleAudio","id","enableLocalAV","camera","toggleLocalVideo","_internalState$getPub2","toggleVideo","toggleRemoteAudio","enableRemoteAV","toggleRemoteVideo","global","module","exports"],"sources":["/home/awolf/WebstormProjects/accelerator-sample-apps-js/react-sample-app/node_modules/opentok-accelerator-core/dist/core.js"],"sourcesContent":["'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* global OT */\n/**\n * Dependencies\n */\nvar util = require('./util');\nvar State = require('./state').default;\nvar accPackEvents = require('./events');\nvar Communication = require('./communication').default;\nvar OpenTokSDK = require('./sdk-wrapper/sdkWrapper');\n\nvar _require = require('./errors'),\n    CoreError = _require.CoreError;\n\nvar _require2 = require('./logging'),\n    message = _require2.message,\n    Analytics = _require2.Analytics,\n    logAction = _require2.logAction,\n    logVariation = _require2.logVariation;\n\n/**\n * Helper methods\n */\n\n\nvar dom = util.dom,\n    path = util.path,\n    pathOr = util.pathOr,\n    properCase = util.properCase;\n\n/**\n * Ensure that we have the required credentials\n * @param {Object} credentials\n * @param {String} credentials.apiKey\n * @param {String} credentials.sessionId\n * @param {String} credentials.token\n */\n\nvar validateCredentials = function validateCredentials() {\n  var credentials = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n  var required = ['apiKey', 'sessionId', 'token'];\n  required.forEach(function (credential) {\n    if (!credentials[credential]) {\n      throw new CoreError(credential + ' is a required credential', 'invalidParameters');\n    }\n  });\n};\n\nvar AccCore = function AccCore(options) {\n  _classCallCheck(this, AccCore);\n\n  _initialiseProps.call(this);\n\n  // Options/credentials validation\n  if (!options) {\n    throw new CoreError('Missing options required for initialization', 'invalidParameters');\n  }\n  var credentials = options.credentials;\n\n  validateCredentials(options.credentials);\n  this.name = options.name;\n\n  // Init analytics\n  this.applicationName = options.applicationName;\n  this.analytics = new Analytics(window.location.origin, credentials.sessionId, null, credentials.apiKey);\n  this.analytics.log(logAction.init, logVariation.attempt);\n\n  // Create session, setup state\n  var sessionProps = options.largeScale ? { connectionEventsSuppressed: true } : undefined;\n  this.session = OT.initSession(credentials.apiKey, credentials.sessionId, sessionProps);\n  this.internalState = new State();\n  this.internalState.setSession(this.session);\n  this.internalState.setCredentials(credentials);\n  this.internalState.setOptions(options);\n\n  // Individual accelerator packs\n  this.communication = null;\n  this.textChat = null;\n  this.screenSharing = null;\n  this.annotation = null;\n  this.archiving = null;\n\n  // Create internal event listeners\n  this.createEventListeners(this.session, options);\n\n  this.analytics.log(logAction.init, logVariation.success);\n}\n\n// OpenTok SDK Wrapper\n\n\n// Expose utility methods\n\n\n/**\n * Get access to an accelerator pack\n * @param {String} packageName - textChat, screenSharing, annotation, or archiving\n * @returns {Object} The instance of the accelerator pack\n */\n\n\n/** Eventing */\n\n/**\n * Register events that can be listened to be other components/modules\n * @param {array | string} events - A list of event names. A single event may\n * also be passed as a string.\n */\n\n\n/**\n * Register a callback for a specific event or pass an object with\n * with event => callback key/value pairs to register listeners for\n * multiple events.\n * @param {String | Object} event - The name of the event\n * @param {Function} callback\n */\n\n\n/**\n * Remove a callback for a specific event.  If no parameters are passed,\n * all event listeners will be removed.\n * @param {String} event - The name of the event\n * @param {Function} callback\n */\n\n\n/**\n * Trigger an event and fire all registered callbacks\n * @param {String} event - The name of the event\n * @param {*} data - Data to be passed to callback functions\n */\n\n\n/**\n * Get the current OpenTok session object\n * @returns {Object}\n */\n\n\n/**\n * Returns the current OpenTok session credentials\n * @returns {Object}\n */\n\n\n/**\n * Returns the options used for initialization\n * @returns {Object}\n */\n\n\n/**\n * Connect to the session\n * @returns {Promise} <resolve: -, reject: Error>\n */\n\n\n/**\n * Disconnect from the session\n * @returns {Promise} <resolve: -, reject: Error>\n */\n\n\n/**\n * Force a remote connection to leave the session\n * @param {Object} connection\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n\n/**\n * Start publishing video and subscribing to streams\n * @param {Object} publisherProps - https://goo.gl/0mL0Eo\n * @returns {Promise} <resolve: State + Publisher, reject: Error>\n */\n\n\n/**\n * Stop all publishing un unsubscribe from all streams\n * @returns {void}\n */\n\n\n/**\n * Start publishing video and subscribing to streams\n * @returns {Object} The internal state of the core session\n */\n\n\n/**\n * Manually subscribe to a stream\n * @param {Object} stream - An OpenTok stream\n * @param {Object} [subscriberProperties] - https://tokbox.com/developer/sdks/js/reference/Session.html#subscribe\n * @param {Boolean} [networkTest] - Subscribing to our own publisher as part of a network test?\n * @returns {Promise} <resolve: Subscriber, reject: Error>\n */\n\n\n/**\n * Manually unsubscribe from a stream\n * @param {Object} subscriber - An OpenTok subscriber object\n * @returns {Promise} <resolve: void, reject: Error>\n */\n\n\n/**\n * Force the publisher of a stream to stop publishing the stream\n * @param {Object} stream\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n\n/**\n * Get the local publisher object for a stream\n * @param {Object} stream - An OpenTok stream object\n * @returns {Object} - The publisher object\n */\n\n\n/**\n * Get the local subscriber objects for a stream\n * @param {Object} stream - An OpenTok stream object\n * @returns {Array} - An array of subscriber object\n */\n\n\n/**\n * Send a signal using the OpenTok signaling apiKey\n * @param {String} type\n * @param {*} [data]\n * @param {Object} [to] - An OpenTok connection object\n * @returns {Promise} <resolve: empty, reject: Error>\n */\n\n\n/**\n * Enable or disable local audio\n * @param {Boolean} enable\n */\n\n\n/**\n * Enable or disable local video\n * @param {Boolean} enable\n */\n\n\n/**\n * Enable or disable remote audio\n * @param {String} id - Subscriber id\n * @param {Boolean} enable\n */\n\n\n/**\n * Enable or disable remote video\n * @param {String} id - Subscriber id\n * @param {Boolean} enable\n */\n;\n\nObject.defineProperty(AccCore, 'OpenTokSDK', {\n  enumerable: true,\n  writable: true,\n  value: OpenTokSDK\n});\nObject.defineProperty(AccCore, 'util', {\n  enumerable: true,\n  writable: true,\n  value: util\n});\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this = this;\n\n  Object.defineProperty(this, 'getAccPack', {\n    enumerable: true,\n    writable: true,\n    value: function value(packageName) {\n      var analytics = _this.analytics,\n          textChat = _this.textChat,\n          screenSharing = _this.screenSharing,\n          annotation = _this.annotation,\n          archiving = _this.archiving;\n\n      analytics.log(logAction.getAccPack, logVariation.attempt);\n      var packages = {\n        textChat: textChat,\n        screenSharing: screenSharing,\n        annotation: annotation,\n        archiving: archiving\n      };\n      analytics.log(logAction.getAccPack, logVariation.success);\n      return packages[packageName];\n    }\n  });\n  Object.defineProperty(this, 'registerEvents', {\n    enumerable: true,\n    writable: true,\n    value: function value(events) {\n      var eventListeners = _this.eventListeners;\n\n      var eventList = Array.isArray(events) ? events : [events];\n      eventList.forEach(function (event) {\n        if (!eventListeners[event]) {\n          eventListeners[event] = new Set();\n        }\n      });\n    }\n  });\n  Object.defineProperty(this, 'on', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, callback) {\n      var eventListeners = _this.eventListeners,\n          on = _this.on;\n      // analytics.log(logAction.on, logVariation.attempt);\n\n      if ((typeof event === 'undefined' ? 'undefined' : _typeof(event)) === 'object') {\n        Object.keys(event).forEach(function (eventName) {\n          on(eventName, event[eventName]);\n        });\n        return;\n      }\n      var eventCallbacks = eventListeners[event];\n      if (!eventCallbacks) {\n        message(event + ' is not a registered event.');\n        // analytics.log(logAction.on, logVariation.fail);\n      } else {\n        eventCallbacks.add(callback);\n        // analytics.log(logAction.on, logVariation.success);\n      }\n    }\n  });\n  Object.defineProperty(this, 'off', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, callback) {\n      var eventListeners = _this.eventListeners;\n      // analytics.log(logAction.off, logVariation.attempt);\n\n      if (!event && !callback) {\n        Object.keys(eventListeners).forEach(function (eventType) {\n          eventListeners[eventType].clear();\n        });\n      } else {\n        var eventCallbacks = eventListeners[event];\n        if (!eventCallbacks) {\n          // analytics.log(logAction.off, logVariation.fail);\n          message(event + ' is not a registered event.');\n        } else {\n          eventCallbacks.delete(callback);\n          // analytics.log(logAction.off, logVariation.success);\n        }\n      }\n    }\n  });\n  Object.defineProperty(this, 'triggerEvent', {\n    enumerable: true,\n    writable: true,\n    value: function value(event, data) {\n      var eventListeners = _this.eventListeners,\n          registerEvents = _this.registerEvents;\n\n      var eventCallbacks = eventListeners[event];\n      if (!eventCallbacks) {\n        registerEvents(event);\n        message(event + ' has been registered as a new event.');\n      } else {\n        eventCallbacks.forEach(function (callback) {\n          return callback(data, event);\n        });\n      }\n    }\n  });\n  Object.defineProperty(this, 'getSession', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getSession();\n    }\n  });\n  Object.defineProperty(this, 'getCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getCredentials();\n    }\n  });\n  Object.defineProperty(this, 'getOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.getOptions();\n    }\n  });\n  Object.defineProperty(this, 'createEventListeners', {\n    enumerable: true,\n    writable: true,\n    value: function value(session, options) {\n      _this.eventListeners = {};\n      var registerEvents = _this.registerEvents,\n          internalState = _this.internalState,\n          triggerEvent = _this.triggerEvent,\n          on = _this.on,\n          getSession = _this.getSession;\n\n      Object.keys(accPackEvents).forEach(function (type) {\n        return registerEvents(accPackEvents[type]);\n      });\n\n      /**\n       * If using screen sharing + annotation in an external window, the screen sharing\n       * package will take care of calling annotation.start() and annotation.linkCanvas()\n       */\n      var usingAnnotation = path('screenSharing.annotation', options);\n      var internalAnnotation = usingAnnotation && !path('screenSharing.externalWindow', options);\n\n      /**\n       * Wrap session events and update internalState when streams are created\n       * or destroyed\n       */\n      accPackEvents.session.forEach(function (eventName) {\n        session.on(eventName, function (event) {\n          if (eventName === 'streamCreated') {\n            internalState.addStream(event.stream);\n          }\n          if (eventName === 'streamDestroyed') {\n            internalState.removeStream(event.stream);\n          }\n          triggerEvent(eventName, event);\n        });\n      });\n\n      if (usingAnnotation) {\n        on('subscribeToScreen', function (_ref) {\n          var subscriber = _ref.subscriber;\n\n          _this.annotation.start(getSession()).then(function () {\n            var absoluteParent = dom.query(path('annotation.absoluteParent.subscriber', options));\n            var linkOptions = absoluteParent ? { absoluteParent: absoluteParent } : null;\n            _this.annotation.linkCanvas(subscriber, subscriber.element.parentElement, linkOptions);\n          });\n        });\n\n        on('unsubscribeFromScreen', function () {\n          _this.annotation.end();\n        });\n      }\n\n      on('startScreenSharing', function (publisher) {\n        internalState.addPublisher('screen', publisher);\n        triggerEvent('startScreenShare', Object.assign({}, { publisher: publisher }, internalState.getPubSub()));\n        if (internalAnnotation) {\n          _this.annotation.start(getSession()).then(function () {\n            var absoluteParent = dom.query(path('annotation.absoluteParent.publisher', options));\n            var linkOptions = absoluteParent ? { absoluteParent: absoluteParent } : null;\n            _this.annotation.linkCanvas(publisher, publisher.element.parentElement, linkOptions);\n          });\n        }\n      });\n\n      on('endScreenSharing', function (publisher) {\n        // delete publishers.screen[publisher.id];\n        internalState.removePublisher('screen', publisher);\n        triggerEvent('endScreenShare', internalState.getPubSub());\n        if (usingAnnotation) {\n          _this.annotation.end();\n        }\n      });\n    }\n  });\n  Object.defineProperty(this, 'setupExternalAnnotation', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.annotation.start(_this.getSession(), { screensharing: true });\n    }\n  });\n  Object.defineProperty(this, 'linkAnnotation', {\n    enumerable: true,\n    writable: true,\n    value: function value(pubSub, annotationContainer, externalWindow) {\n      var annotation = _this.annotation,\n          internalState = _this.internalState;\n\n      annotation.linkCanvas(pubSub, annotationContainer, {\n        externalWindow: externalWindow\n      });\n\n      if (externalWindow) {\n        // Add subscribers to the external window\n        var streams = internalState.getStreams();\n        var cameraStreams = Object.keys(streams).reduce(function (acc, streamId) {\n          var stream = streams[streamId];\n          return stream.videoType === 'camera' || stream.videoType === 'sip' ? acc.concat(stream) : acc;\n        }, []);\n        cameraStreams.forEach(annotation.addSubscriberToExternalWindow);\n      }\n    }\n  });\n  Object.defineProperty(this, 'initPackages', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n          getSession = _this.getSession,\n          getOptions = _this.getOptions,\n          internalState = _this.internalState;\n      var on = _this.on,\n          registerEvents = _this.registerEvents,\n          setupExternalAnnotation = _this.setupExternalAnnotation,\n          triggerEvent = _this.triggerEvent,\n          linkAnnotation = _this.linkAnnotation;\n\n      analytics.log(logAction.initPackages, logVariation.attempt);\n      var session = getSession();\n      var options = getOptions();\n      /**\n       * Try to require a package.  If 'require' is unavailable, look for\n       * the package in global scope.  A switch ttatement is used because\n       * webpack and Browserify aren't able to resolve require statements\n       * that use variable names.\n       * @param {String} packageName - The name of the npm package\n       * @param {String} globalName - The name of the package if exposed on global/window\n       * @returns {Object}\n       */\n      var optionalRequire = function optionalRequire(packageName, globalName) {\n        var result = void 0;\n        /* eslint-disable global-require, import/no-extraneous-dependencies, import/no-unresolved */\n        try {\n          switch (packageName) {\n            case 'opentok-text-chat':\n              result = require('opentok-text-chat');\n              break;\n            case 'opentok-screen-sharing':\n              result = require('opentok-screen-sharing');\n              break;\n            case 'opentok-annotation':\n              result = require('opentok-annotation');\n              break;\n            case 'opentok-archiving':\n              result = require('opentok-archiving');\n              break;\n            default:\n              break;\n          }\n          /* eslint-enable global-require */\n        } catch (error) {\n          result = window[globalName];\n        }\n        if (!result) {\n          analytics.log(logAction.initPackages, logVariation.fail);\n          throw new CoreError('Could not load ' + packageName, 'missingDependency');\n        }\n        return result;\n      };\n\n      var availablePackages = {\n        textChat: function textChat() {\n          return optionalRequire('opentok-text-chat', 'TextChatAccPack');\n        },\n        screenSharing: function screenSharing() {\n          return optionalRequire('opentok-screen-sharing', 'ScreenSharingAccPack');\n        },\n        annotation: function annotation() {\n          return optionalRequire('opentok-annotation', 'AnnotationAccPack');\n        },\n        archiving: function archiving() {\n          return optionalRequire('opentok-archiving', 'ArchivingAccPack');\n        }\n      };\n\n      var packages = {};\n      (path('packages', options) || []).forEach(function (acceleratorPack) {\n        if (availablePackages[acceleratorPack]) {\n          // eslint-disable-next-line no-param-reassign\n          packages[properCase(acceleratorPack)] = availablePackages[acceleratorPack]();\n        } else {\n          message(acceleratorPack + ' is not a valid accelerator pack');\n        }\n      });\n\n      /**\n       * Get containers for streams, controls, and the chat widget\n       */\n      var getDefaultContainer = function getDefaultContainer(pubSub) {\n        return document.getElementById(pubSub + 'Container');\n      };\n      var getContainerElements = function getContainerElements() {\n        // Need to use path to check for null values\n        var controls = pathOr('#videoControls', 'controlsContainer', options);\n        var chat = pathOr('#chat', 'textChat.container', options);\n        var stream = pathOr(getDefaultContainer, 'streamContainers', options);\n        return { stream: stream, controls: controls, chat: chat };\n      };\n      /** *** *** *** *** */\n\n      /**\n       * Return options for the specified package\n       * @param {String} packageName\n       * @returns {Object}\n       */\n      var packageOptions = function packageOptions(packageName) {\n        /**\n         * Methods to expose to accelerator packs\n         */\n        var accPack = {\n          registerEventListener: on, // Legacy option\n          on: on,\n          registerEvents: registerEvents,\n          triggerEvent: triggerEvent,\n          setupExternalAnnotation: setupExternalAnnotation,\n          linkAnnotation: linkAnnotation\n        };\n\n        /**\n         * If options.controlsContainer/containers.controls is null,\n         * accelerator packs should not append their controls.\n         */\n        var containers = getContainerElements();\n        var appendControl = !!containers.controls;\n        var controlsContainer = containers.controls; // Legacy option\n        var streamContainers = containers.stream;\n        var baseOptions = {\n          session: session,\n          core: accPack,\n          accPack: accPack,\n          controlsContainer: controlsContainer,\n          appendControl: appendControl,\n          streamContainers: streamContainers\n        };\n\n        switch (packageName) {\n          /* beautify ignore:start */\n          case 'communication':\n            {\n              return Object.assign({}, baseOptions, { state: internalState, analytics: analytics }, options.communication);\n            }\n          case 'textChat':\n            {\n              var textChatOptions = {\n                textChatContainer: path('textChat.container', options),\n                waitingMessage: path('textChat.waitingMessage', options),\n                sender: { alias: path('textChat.name', options) },\n                alwaysOpen: path('textChat.alwaysOpen', options)\n              };\n              return Object.assign({}, baseOptions, textChatOptions);\n            }\n          case 'screenSharing':\n            {\n              var screenSharingContainer = { screenSharingContainer: streamContainers };\n              return Object.assign({}, baseOptions, screenSharingContainer, options.screenSharing);\n            }\n          case 'annotation':\n            {\n              return Object.assign({}, baseOptions, options.annotation);\n            }\n          case 'archiving':\n            {\n              return Object.assign({}, baseOptions, options.archiving);\n            }\n          default:\n            return {};\n          /* beautify ignore:end */\n        }\n      };\n\n      /** Create instances of each package */\n      // eslint-disable-next-line global-require,import/no-extraneous-dependencies\n\n      _this.communication = new Communication(packageOptions('communication'));\n      _this.textChat = packages.TextChat ? new packages.TextChat(packageOptions('textChat')) : null;\n      _this.screenSharing = packages.ScreenSharing ? new packages.ScreenSharing(packageOptions('screenSharing')) : null;\n      _this.annotation = packages.Annotation ? new packages.Annotation(packageOptions('annotation')) : null;\n      _this.archiving = packages.Archiving ? new packages.Archiving(packageOptions('archiving')) : null;\n\n      analytics.log(logAction.initPackages, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'connect', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n          getSession = _this.getSession,\n          initPackages = _this.initPackages,\n          triggerEvent = _this.triggerEvent,\n          getCredentials = _this.getCredentials;\n\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.connect, logVariation.attempt);\n        var session = getSession();\n\n        var _getCredentials = getCredentials(),\n            token = _getCredentials.token;\n\n        session.connect(token, function (error) {\n          if (error) {\n            message(error);\n            analytics.log(logAction.connect, logVariation.fail);\n            return reject(error);\n          }\n          var sessionId = session.sessionId,\n              apiKey = session.apiKey;\n\n          analytics.update(sessionId, path('connection.connectionId', session), apiKey);\n          analytics.log(logAction.connect, logVariation.success);\n          initPackages();\n          triggerEvent('connected', session);\n          return resolve({ connections: session.connections.length() });\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'disconnect', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var analytics = _this.analytics,\n          getSession = _this.getSession,\n          internalState = _this.internalState;\n\n      analytics.log(logAction.disconnect, logVariation.attempt);\n      getSession().disconnect();\n      internalState.reset();\n      analytics.log(logAction.disconnect, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'forceDisconnect', {\n    enumerable: true,\n    writable: true,\n    value: function value(connection) {\n      var analytics = _this.analytics,\n          getSession = _this.getSession;\n\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.forceDisconnect, logVariation.attempt);\n        getSession().forceDisconnect(connection, function (error) {\n          if (error) {\n            analytics.log(logAction.forceDisconnect, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.forceDisconnect, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'startCall', {\n    enumerable: true,\n    writable: true,\n    value: function value(publisherProps) {\n      return _this.communication.startCall(publisherProps);\n    }\n  });\n  Object.defineProperty(this, 'endCall', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.communication.endCall();\n    }\n  });\n  Object.defineProperty(this, 'state', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.internalState.all();\n    }\n  });\n  Object.defineProperty(this, 'subscribe', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream, subscriberProperties) {\n      var networkTest = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      return _this.communication.subscribe(stream, subscriberProperties, networkTest);\n    }\n  });\n  Object.defineProperty(this, 'unsubscribe', {\n    enumerable: true,\n    writable: true,\n    value: function value(subscriber) {\n      return _this.communication.unsubscribe(subscriber);\n    }\n  });\n  Object.defineProperty(this, 'forceUnpublish', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      var analytics = _this.analytics,\n          getSession = _this.getSession;\n\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.forceUnpublish, logVariation.attempt);\n        getSession().forceUnpublish(stream, function (error) {\n          if (error) {\n            analytics.log(logAction.forceUnpublish, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.forceUnpublish, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'getPublisherForStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      return _this.getSession().getPublisherForStream(stream);\n    }\n  });\n  Object.defineProperty(this, 'getSubscribersForStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      return _this.getSession().getSubscribersForStream(stream);\n    }\n  });\n  Object.defineProperty(this, 'signal', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, data, to) {\n      var analytics = _this.analytics,\n          getSession = _this.getSession;\n\n      return new Promise(function (resolve, reject) {\n        analytics.log(logAction.signal, logVariation.attempt);\n        var session = getSession();\n        var signalObj = Object.assign({}, type ? { type: type } : null, data ? { data: JSON.stringify(data) } : null, to ? { to: to } : null // eslint-disable-line comma-dangle\n        );\n        session.signal(signalObj, function (error) {\n          if (error) {\n            analytics.log(logAction.signal, logVariation.fail);\n            reject(error);\n          } else {\n            analytics.log(logAction.signal, logVariation.success);\n            resolve();\n          }\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'toggleLocalAudio', {\n    enumerable: true,\n    writable: true,\n    value: function value(enable) {\n      var analytics = _this.analytics,\n          internalState = _this.internalState,\n          communication = _this.communication;\n\n      analytics.log(logAction.toggleLocalAudio, logVariation.attempt);\n\n      var _internalState$getPub = internalState.getPubSub(),\n          publishers = _internalState$getPub.publishers;\n\n      var toggleAudio = function toggleAudio(id) {\n        return communication.enableLocalAV(id, 'audio', enable);\n      };\n      Object.keys(publishers.camera).forEach(toggleAudio);\n      analytics.log(logAction.toggleLocalAudio, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleLocalVideo', {\n    enumerable: true,\n    writable: true,\n    value: function value(enable) {\n      var analytics = _this.analytics,\n          internalState = _this.internalState,\n          communication = _this.communication;\n\n      analytics.log(logAction.toggleLocalVideo, logVariation.attempt);\n\n      var _internalState$getPub2 = internalState.getPubSub(),\n          publishers = _internalState$getPub2.publishers;\n\n      var toggleVideo = function toggleVideo(id) {\n        return communication.enableLocalAV(id, 'video', enable);\n      };\n      Object.keys(publishers.camera).forEach(toggleVideo);\n      analytics.log(logAction.toggleLocalVideo, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleRemoteAudio', {\n    enumerable: true,\n    writable: true,\n    value: function value(id, enable) {\n      var analytics = _this.analytics,\n          communication = _this.communication;\n\n      analytics.log(logAction.toggleRemoteAudio, logVariation.attempt);\n      communication.enableRemoteAV(id, 'audio', enable);\n      analytics.log(logAction.toggleRemoteAudio, logVariation.success);\n    }\n  });\n  Object.defineProperty(this, 'toggleRemoteVideo', {\n    enumerable: true,\n    writable: true,\n    value: function value(id, enable) {\n      var analytics = _this.analytics,\n          communication = _this.communication;\n\n      analytics.log(logAction.toggleRemoteVideo, logVariation.attempt);\n      communication.enableRemoteAV(id, 'video', enable);\n      analytics.log(logAction.toggleRemoteVideo, logVariation.success);\n    }\n  });\n};\n\nif (global === window) {\n  window.AccCore = AccCore;\n}\n\nmodule.exports = AccCore;"],"mappings":"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a,GAAG,IAAI7C,KAAK,CAAC,CAAC;EAChC,IAAI,CAAC6C,aAAa,CAACC,UAAU,CAAC,IAAI,CAACJ,OAAO,CAAC;EAC3C,IAAI,CAACG,aAAa,CAACE,cAAc,CAAC9B,WAAW,CAAC;EAC9C,IAAI,CAAC4B,aAAa,CAACG,UAAU,CAACvB,OAAO,CAAC;;EAEtC;EACA,IAAI,CAACwB,aAAa,GAAG,IAAI;EACzB,IAAI,CAACC,QAAQ,GAAG,IAAI;EACpB,IAAI,CAACC,aAAa,GAAG,IAAI;EACzB,IAAI,CAACC,UAAU,GAAG,IAAI;EACtB,IAAI,CAACC,SAAS,GAAG,IAAI;;EAErB;EACA,IAAI,CAACC,oBAAoB,CAAC,IAAI,CAACZ,OAAO,EAAEjB,OAAO,CAAC;EAEhD,IAAI,CAACK,SAAS,CAACM,GAAG,CAAC1B,SAAS,CAAC2B,IAAI,EAAE1B,YAAY,CAAC4C,OAAO,CAAC;AAC1D;;AAEA;;AAGA;;AAGA;AACA;AACA;AACA;AACA;;AAGA;;AAEA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA,GAJA;AAOAC,MAAM,CAACC,cAAc,CAACjC,OAAO,EAAE,YAAY,EA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"},"metadata":{},"sourceType":"script","externalDependencies":[]}