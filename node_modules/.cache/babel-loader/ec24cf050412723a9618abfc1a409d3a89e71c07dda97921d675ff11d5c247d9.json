{"ast":null,"code":"/* global OTKAnalytics define */\n(function () {\n  /** Include external dependencies */\n\n  var _;\n  var $;\n  var OTKAnalytics;\n  if (typeof module === 'object' && typeof module.exports === 'object') {\n    /* eslint-disable import/no-unresolved */\n    _ = require('underscore');\n    $ = require('jquery');\n    window.jQuery = $;\n    window.moment = require('moment');\n    require('kuende-livestamp');\n    OTKAnalytics = require('opentok-solutions-logging');\n    /* eslint-enable import/no-unresolved */\n  } else {\n    _ = this._;\n    $ = this.$;\n    window.jQuery = $;\n    window.moment = this.moment;\n    OTKAnalytics = this.OTKAnalytics;\n  }\n\n  // Reference to instance of TextChatAccPack\n  var _this;\n  var _session;\n\n  /** Analytics */\n  var _otkanalytics;\n  var _logEventData = {\n    // vars for the analytics logs. Internal use\n    clientVersion: 'js-vsol-1.0.36',\n    // x.y.z filled by npm build script\n    componentId: 'textChatAccPack',\n    name: 'guidTextChatAccPack',\n    actionInitialize: 'Init',\n    actionStart: 'Start',\n    actionEnd: 'End',\n    actionOpen: 'OpenTC',\n    actionClose: 'CloseTC',\n    actionSendMessage: 'SendMessage',\n    actionReceiveMessage: 'ReceiveMessage',\n    actionSetMaxLength: 'SetMaxLength',\n    variationAttempt: 'Attempt',\n    variationError: 'Failure',\n    variationSuccess: 'Success'\n  };\n  var _logAnalytics = function () {\n    // init the analytics logs\n    var _source = window.location.href;\n    var otkanalyticsData = {\n      clientVersion: _logEventData.clientVersion,\n      source: _source,\n      componentId: _logEventData.componentId,\n      name: _logEventData.name\n    };\n    _otkanalytics = new OTKAnalytics(otkanalyticsData);\n    var sessionInfo = {\n      sessionId: _session.id,\n      connectionId: _session.connection.connectionId,\n      partnerId: _session.apiKey\n    };\n    _otkanalytics.addSessionInfo(sessionInfo);\n  };\n  var _log = function (action, variation) {\n    var data = {\n      action: action,\n      variation: variation\n    };\n    _otkanalytics.logEvent(data);\n  };\n\n  /** End Analytics */\n\n  // State vars\n  var _enabled = false;\n  var _displayed = false;\n  var _initialized = false;\n  var _controlAdded = false;\n  var _sender;\n  var _composer;\n  var _lastMessage;\n  var _newMessages;\n  var _sentMessageHistory = [];\n  var _remoteParticipant = false;\n\n  // Reference to Accelerator Pack Common Layer\n  var _accPack;\n  var _triggerEvent = function (event, data) {\n    _accPack && _accPack.triggerEvent(event, data);\n  };\n\n  // Private methods\n  var _escapeHtml = function (string) {\n    var charactersMap = {\n      '<': '&lt;',\n      '>': '&gt;',\n      '\"': '&quot;',\n      \"'\": '&#x27;'\n    };\n    return (string || '').toString().replace(/[<>\"']/ig, function (match) {\n      return charactersMap[match];\n    });\n  };\n  var renderUILayout = function () {\n    var deliveryMessage = _this.options.waitingMessage || 'Messages will be delivered once your contact arrives';\n    /* eslint-disable max-len, prefer-template */\n    return ['<div class=\"ots-text-chat-container\">', '<div class=\"ots-text-chat\">', '<div class=\"ots-messages-header ots-hidden\" id=\"chatHeader\">', '<span>Chat with</span>', '</div>', '<div id=\"otsChatWrap\">', '<div class=\"ots-messages-holder\" id=\"messagesHolder\">', '<div class=\"ots-messages-alert ots-hidden\" id=\"messagesWaiting\">' + _escapeHtml(deliveryMessage) + '</div>', '<div class=\"ots-message-item ots-message-sent\">', '</div>', '</div>', '<div class=\"ots-send-message-box\">', '<input type=\"text\" maxlength=' + _escapeHtml(_this.options.limitCharacterMessage) + ' class=\"ots-message-input\" placeholder=\"Enter your message here\" id=\"messageBox\">', '<button class=\"ots-icon-check\" id=\"sendMessage\" type=\"submit\"></button>', '<div class=\"ots-character-count\"><span><span id=\"characterCount\">0</span>/' + _escapeHtml(_this.options.limitCharacterMessage) + ' characters</span></div>', '</div>', '</div>', '</div>', '</div>'].join('\\n');\n    /* eslint-enable max-len, prefer-template */\n  };\n  var _shouldAppendMessage = function (data) {\n    if (_lastMessage) {\n      return _lastMessage.sender.id === data.sender.id && _lastMessage.sender.id === data.sender.id;\n    }\n    return false;\n  };\n  var _cleanComposer = function () {\n    _composer.value = '';\n    $('#characterCount').text('0');\n  };\n  var _getBubbleHtml = function (message) {\n    /* eslint-disable max-len, prefer-template */\n    var bubble = ['<div class=\"' + _escapeHtml(message.messageClass) + '\" >', '<div class=\"ots-user-name-initial\"> ' + _escapeHtml(message.username[0]) + '</div>', '<div class=\"ots-item-timestamp\"> ' + _escapeHtml(message.username) + ', <span data-livestamp=\" ' + new Date(message.time) + '\" </span></div>', '<div class=\"ots-item-text\">', '<span> ' + _escapeHtml(message.message) + '</span>', '</div>', '</div>'].join('\\n');\n    /* eslint-enable max-len, prefer-template */\n    return bubble;\n  };\n  var _renderChatMessage = function (messageSenderId, messageSenderAlias, message, sentOn) {\n    var sentByClass = _sender.id === messageSenderId ? 'ots-message-item ots-message-sent' : 'ots-message-item';\n    var view = _getBubbleHtml({\n      username: messageSenderAlias,\n      message: message,\n      messageClass: sentByClass,\n      time: sentOn\n    });\n    var chatholder = $(_newMessages);\n    chatholder.append(view);\n    chatholder[0].scrollTop = chatholder[0].scrollHeight;\n  };\n  var _handleMessageSent = function (data) {\n    _cleanComposer();\n    if (_shouldAppendMessage(data)) {\n      $('.ots-item-text').last().append(['<span>', _escapeHtml(data.message), '</span>'].join(''));\n      var chatholder = $(_newMessages);\n      chatholder[0].scrollTop = chatholder[0].scrollHeight;\n    } else {\n      _renderChatMessage(_sender.id, _sender.alias, data.message, data.sentOn);\n    }\n    _lastMessage = data;\n    _triggerEvent('messageSent', data);\n  };\n  var _handleMessageError = function (error) {\n    console.log(error.code, error.message);\n    if (error.code === 500) {\n      var view = _.template($('#chatError').html());\n      $(_this.comms_elements.messagesView).append(view());\n    }\n    _triggerEvent('errorSendingMessage', error);\n  };\n  var _showWaitingMessage = function () {\n    var el = document.getElementById('messagesWaiting');\n    el && el.classList.remove('ots-hidden');\n    var parent = document.getElementById('messagesHolder');\n    parent && parent.classList.add('has-alert');\n  };\n  var _hideWaitingMessage = function () {\n    var el = document.getElementById('messagesWaiting');\n    el && el.classList.add('ots-hidden');\n    var parent = document.getElementById('messagesHolder');\n    parent && parent.classList.add('has-alert');\n  };\n  var _sendMessage = function (recipient, message) {\n    var deferred = new $.Deferred();\n    _sentMessageHistory.push({\n      recipient: recipient,\n      message: message\n    });\n    if (!_remoteParticipant) {\n      _showWaitingMessage();\n      deferred.resolve();\n    } else {\n      _hideWaitingMessage();\n    }\n    var messageData = {\n      text: message,\n      sender: {\n        id: _sender.id,\n        alias: _sender.alias\n      },\n      sentOn: Date.now()\n    };\n\n    // Add SEND_MESSAGE attempt log event\n    _log(_logEventData.actionSendMessage, _logEventData.variationAttempt);\n    if (recipient === undefined) {\n      _session.signal({\n        type: 'text-chat',\n        data: JSON.stringify(messageData)\n      }, function (error) {\n        if (error) {\n          var errorMessage = 'Error sending a message. ';\n          // Add SEND_MESSAGE failure log event\n          _log(_logEventData.actionSendMessage, _logEventData.variationFailure);\n          if (error.code === 413) {\n            errorMessage += 'The chat message is over size limit.';\n          } else {\n            if (error.code === 500) {\n              errorMessage += 'Check your network connection.';\n            }\n          }\n          deferred.reject(_.extend(_.omit(error, 'message')), {\n            message: errorMessage\n          });\n        } else {\n          console.log('Message sent');\n          // Add SEND_MESSAGE success log event\n          _log(_logEventData.actionSendMessage, _logEventData.variationSuccess);\n          deferred.resolve(messageData);\n        }\n      });\n    } else {\n      _session.signal({\n        type: 'text-chat',\n        data: JSON.stringify(messageData),\n        to: recipient\n      }, function (error) {\n        if (error) {\n          console.log('Error sending a message');\n          _log(_logEventData.actionSendMessage, _logEventData.variationFailure);\n          deferred.resolve(error);\n        } else {\n          console.log('Message sent');\n          deferred.resolve(messageData);\n          _log(_logEventData.actionSendMessage, _logEventData.variationSuccess);\n        }\n      });\n    }\n    return deferred.promise();\n  };\n  var _sendTxtMessage = function (text) {\n    if (!_.isEmpty(text)) {\n      $.when(_sendMessage(_this._remoteParticipant, text)).then(function () {\n        _handleMessageSent({\n          sender: {\n            id: _sender.id,\n            alias: _sender.alias\n          },\n          message: text,\n          sentOn: Date.now()\n        });\n        if (this.futureMessageNotice) {\n          this.futureMessageNotice = false;\n        }\n      }, function (error) {\n        _handleMessageError(error);\n      });\n    }\n  };\n  var _setupUI = function () {\n    // Add INITIALIZE success log event\n    _log(_logEventData.actionInitialize, _logEventData.variationAttempt);\n    var parent = document.querySelector(_this.options.textChatContainer) || document.body;\n    var chatView = document.createElement('section');\n    chatView.innerHTML = renderUILayout();\n    _composer = chatView.querySelector('#messageBox');\n    _newMessages = chatView.querySelector('#messagesHolder');\n    _composer.onkeyup = function updateCharCounter() {\n      $('#characterCount').text(_composer.value.length);\n      if (_composer.value.length !== 0) {\n        $('.ots-icon-check').addClass('active');\n      } else {\n        $('.ots-icon-check').removeClass('active');\n      }\n    };\n    _composer.onkeydown = function controlComposerInput(event) {\n      var isEnter = event.which === 13 || event.keyCode === 13;\n      if (!event.shiftKey && isEnter) {\n        event.preventDefault();\n        _sendTxtMessage(_composer.value);\n      }\n    };\n    parent.appendChild(chatView);\n    document.getElementById('sendMessage').onclick = function () {\n      _sendTxtMessage(_composer.value);\n    };\n    // Add INITIALIZE success log event\n    _log(_logEventData.actionInitialize, _logEventData.variationSuccess);\n  };\n  var _onIncomingMessage = function (signal) {\n    _log(_logEventData.actionReceiveMessage, _logEventData.variationAttempt);\n    var data = JSON.parse(signal.data);\n    if (_shouldAppendMessage(data)) {\n      $('.ots-item-text').last().append(['<span>', _escapeHtml(data.text), '</span>'].join(''));\n    } else {\n      _renderChatMessage(data.sender.id, data.sender.alias, data.text, data.sentOn);\n    }\n    _lastMessage = data;\n    _log(_logEventData.actionReceiveMessage, _logEventData.variationSuccess);\n  };\n  var _handleTextChat = function (event) {\n    var me = _session.connection.connectionId;\n    var from = event.from.connectionId;\n    if (from !== me) {\n      var handler = _onIncomingMessage(event);\n      if (handler && typeof handler === 'function') {\n        handler(event);\n      }\n      _triggerEvent('messageReceived', event);\n    }\n  };\n  var _deliverUnsentMessages = function () {\n    _sentMessageHistory.forEach(function (message) {\n      _sendMessage(message.recipient, message.message);\n    });\n    _sentMessageHistory = [];\n  };\n  var _initTextChat = function () {\n    _log(_logEventData.actionStart, _logEventData.variationAttempt);\n    _enabled = true;\n    _displayed = true;\n    _initialized = true;\n    _setupUI();\n    _triggerEvent('showTextChat');\n    _session.on('signal:text-chat', _handleTextChat);\n    _log(_logEventData.actionStart, _logEventData.variationSuccess);\n  };\n  var _showTextChat = function () {\n    _log(_logEventData.actionOpen, _logEventData.variationAttempt);\n    document.querySelector(_this.options.textChatContainer).classList.remove('ots-hidden');\n    _displayed = true;\n    _triggerEvent('showTextChat');\n\n    // Add OPEN success log event\n    _log(_logEventData.actionOpen, _logEventData.variationSuccess);\n  };\n  var _hideTextChat = function () {\n    _log(_logEventData.actionClose, _logEventData.variationAttempt);\n    _log(_logEventData.actionEnd, _logEventData.variationAttempt);\n    document.querySelector(_this.options.textChatContainer).classList.add('ots-hidden');\n    _displayed = false;\n    _triggerEvent('hideTextChat');\n\n    // Add CLOSE success log event\n    _log(_logEventData.actionClose, _logEventData.variationSuccess);\n    _log(_logEventData.actionEnd, _logEventData.variationSuccess);\n  };\n  var _appendControl = function () {\n    var feedControls = document.querySelector(_this.options.controlsContainer);\n    var el = document.createElement('div');\n    el.innerHTML = '<div class=\"ots-video-control circle text-chat enabled\" id=\"enableTextChat\"></div>';\n    var enableTextChat = el.firstChild;\n    feedControls.appendChild(enableTextChat);\n    _controlAdded = true;\n    enableTextChat.onclick = function () {\n      if (!_initialized) {\n        _initTextChat();\n      } else if (!_displayed) {\n        _showTextChat();\n      } else {\n        _hideTextChat();\n      }\n    };\n  };\n  var _validateOptions = function (options) {\n    if (!options.session) {\n      throw new Error('Text Chat Accelerator Pack requires an OpenTok session.');\n    }\n\n    // Generates a random alpha-numeric string of n length\n    var uniqueString = function (length) {\n      var len = length || 3;\n      return Math.random().toString(36).substr(2, len);\n    };\n\n    // Returns session id prepended and appended with unique strings\n    var generateUserId = function () {\n      return [uniqueString(), _session.id, uniqueString()].join('');\n    };\n    _session = _.property('session')(options);\n    _accPack = _.property('accPack')(options);\n\n    /**\n     * Create arbitary values for sender id and alias if not recieved\n     * in options hash.\n     */\n    _sender = _.defaults(options.sender || {}, {\n      id: generateUserId(),\n      alias: ['User', uniqueString()].join(' ')\n    });\n    return _.defaults(_.omit(options, ['accPack', '_sender']), {\n      limitCharacterMessage: 160,\n      controlsContainer: '#feedControls',\n      textChatContainer: '#chatContainer',\n      alwaysOpen: false,\n      appendControl: true\n    });\n  };\n  var _registerEvents = function () {\n    var events = ['showTextChat', 'hideTextChat', 'messageSent', 'errorSendingMessage', 'messageReceived'];\n    _accPack && _accPack.registerEvents(events);\n  };\n  var _handleConnectionCreated = function (event) {\n    if (event && event.connection.connectionId !== _session.connection.connectionId) {\n      _remoteParticipant = true;\n      _hideWaitingMessage();\n    }\n  };\n  var _handleStreamCreated = function (event) {\n    if (event && event.stream.connection.connectionId !== _session.connection.connectionId) {\n      _remoteParticipant = true;\n      _hideWaitingMessage();\n    }\n  };\n  var _handleStreamDestroyed = function () {\n    if (_session.streams.length() < 2) {\n      _remoteParticipant = false;\n    }\n  };\n  var _addEventListeners = function () {\n    if (_accPack) {\n      _accPack.registerEventListener('streamCreated', _handleStreamCreated);\n      _accPack.registerEventListener('streamDestroyed', _handleStreamDestroyed);\n      _accPack.registerEventListener('startCall', function () {\n        if (!_this.options.alwaysOpen) {\n          if (_controlAdded) {\n            document.querySelector('#enableTextChat').classList.remove('ots-hidden');\n          } else {\n            _this.options.appendControl && _appendControl();\n          }\n        }\n      });\n      _accPack.registerEventListener('endCall', function () {\n        if (!_this.options.alwaysOpen) {\n          document.getElementById('enableTextChat').classList.add('ots-hidden');\n          if (_displayed) {\n            _hideTextChat();\n          }\n        }\n      });\n    } else {\n      _session.on('streamCreated', _handleStreamCreated);\n      _session.on('streamDestroyed', _handleStreamDestroyed);\n    }\n    _session.on('connectionCreated', _handleConnectionCreated);\n\n    /**\n     * We need to check for remote participants in case we were the last party to join and\n     * the session event fired before the text chat component was initialized.\n     */\n    _handleStreamCreated();\n  };\n\n  // Constructor\n  var TextChatAccPack = function (options) {\n    // Save a reference to this\n    _this = this;\n\n    // Extend instance and set private vars\n    _this.options = _validateOptions(options);\n\n    // Init the analytics logs\n    _logAnalytics();\n    if (!!_.property('_this.options.limitCharacterMessage')(options)) {\n      _log(_logEventData.actionSetMaxLength, _logEventData.variationSuccess);\n    }\n    if (_this.options.alwaysOpen) {\n      _initTextChat();\n    }\n    if (_this.options.appendControl) {\n      _appendControl();\n    }\n    _registerEvents();\n    _addEventListeners();\n  };\n  TextChatAccPack.prototype = {\n    constructor: TextChatAccPack,\n    isEnabled: function () {\n      return _enabled;\n    },\n    isDisplayed: function () {\n      return _displayed;\n    },\n    showTextChat: function () {\n      _showTextChat();\n    },\n    hideTextChat: function () {\n      _hideTextChat();\n    },\n    deliverUnsentMessages: function () {\n      _deliverUnsentMessages();\n    }\n  };\n  if (typeof exports === 'object') {\n    module.exports = TextChatAccPack;\n  } else if (typeof define === 'function' && define.amd) {\n    define(function () {\n      return TextChatAccPack;\n    });\n  } else {\n    this.TextChatAccPack = TextChatAccPack;\n  }\n}).call(this);","map":{"version":3,"names":["_","$","OTKAnalytics","module","exports","require","window","jQuery","moment","_this","_session","_otkanalytics","_logEventData","clientVersion","componentId","name","actionInitialize","actionStart","actionEnd","actionOpen","actionClose","actionSendMessage","actionReceiveMessage","actionSetMaxLength","variationAttempt","variationError","variationSuccess","_logAnalytics","_source","location","href","otkanalyticsData","source","sessionInfo","sessionId","id","connectionId","connection","partnerId","apiKey","addSessionInfo","_log","action","variation","data","logEvent","_enabled","_displayed","_initialized","_controlAdded","_sender","_composer","_lastMessage","_newMessages","_sentMessageHistory","_remoteParticipant","_accPack","_triggerEvent","event","triggerEvent","_escapeHtml","string","charactersMap","toString","replace","match","renderUILayout","deliveryMessage","options","waitingMessage","limitCharacterMessage","join","_shouldAppendMessage","sender","_cleanComposer","value","text","_getBubbleHtml","message","bubble","messageClass","username","Date","time","_renderChatMessage","messageSenderId","messageSenderAlias","sentOn","sentByClass","view","chatholder","append","scrollTop","scrollHeight","_handleMessageSent","last","alias","_handleMessageError","error","console","log","code","template","html","comms_elements","messagesView","_showWaitingMessage","el","document","getElementById","classList","remove","parent","add","_hideWaitingMessage","_sendMessage","recipient","deferred","Deferred","push","resolve","messageData","now","undefined","signal","type","JSON","stringify","errorMessage","variationFailure","reject","extend","omit","to","promise","_sendTxtMessage","isEmpty","when","then","futureMessageNotice","_setupUI","querySelector","textChatContainer","body","chatView","createElement","innerHTML","onkeyup","updateCharCounter","length","addClass","removeClass","onkeydown","controlComposerInput","isEnter","which","keyCode","shiftKey","preventDefault","appendChild","onclick","_onIncomingMessage","parse","_handleTextChat","me","from","handler","_deliverUnsentMessages","forEach","_initTextChat","on","_showTextChat","_hideTextChat","_appendControl","feedControls","controlsContainer","enableTextChat","firstChild","_validateOptions","session","Error","uniqueString","len","Math","random","substr","generateUserId","property","defaults","alwaysOpen","appendControl","_registerEvents","events","registerEvents","_handleConnectionCreated","_handleStreamCreated","stream","_handleStreamDestroyed","streams","_addEventListeners","registerEventListener","TextChatAccPack","prototype","constructor","isEnabled","isDisplayed","showTextChat","hideTextChat","deliverUnsentMessages","define","amd","call"],"sources":["/home/awolf/WebstormProjects/accelerator-sample-apps-js/react-sample-app/node_modules/opentok-text-chat/dist/opentok-text-chat.js"],"sourcesContent":["/* global OTKAnalytics define */\n(function () {\n\n  /** Include external dependencies */\n\n  var _;\n  var $;\n  var OTKAnalytics;\n\n  if (typeof module === 'object' && typeof module.exports === 'object') {\n    /* eslint-disable import/no-unresolved */\n    _ = require('underscore');\n    $ = require('jquery');\n    window.jQuery = $;\n    window.moment = require('moment');\n    require('kuende-livestamp');\n    OTKAnalytics = require('opentok-solutions-logging');\n    /* eslint-enable import/no-unresolved */\n  } else {\n    _ = this._;\n    $ = this.$;\n    window.jQuery = $;\n    window.moment = this.moment;\n    OTKAnalytics = this.OTKAnalytics;\n  }\n\n\n  // Reference to instance of TextChatAccPack\n  var _this;\n  var _session;\n\n  /** Analytics */\n  var _otkanalytics;\n\n  var _logEventData = {\n    // vars for the analytics logs. Internal use\n    clientVersion: 'js-vsol-1.0.36', // x.y.z filled by npm build script\n    componentId: 'textChatAccPack',\n    name: 'guidTextChatAccPack',\n    actionInitialize: 'Init',\n    actionStart: 'Start',\n    actionEnd: 'End',\n    actionOpen: 'OpenTC',\n    actionClose: 'CloseTC',\n    actionSendMessage: 'SendMessage',\n    actionReceiveMessage: 'ReceiveMessage',\n    actionSetMaxLength: 'SetMaxLength',\n    variationAttempt: 'Attempt',\n    variationError: 'Failure',\n    variationSuccess: 'Success'\n  };\n\n\n  var _logAnalytics = function () {\n\n    // init the analytics logs\n    var _source = window.location.href;\n\n    var otkanalyticsData = {\n      clientVersion: _logEventData.clientVersion,\n      source: _source,\n      componentId: _logEventData.componentId,\n      name: _logEventData.name\n    };\n\n    _otkanalytics = new OTKAnalytics(otkanalyticsData);\n\n    var sessionInfo = {\n      sessionId: _session.id,\n      connectionId: _session.connection.connectionId,\n      partnerId: _session.apiKey\n    };\n\n    _otkanalytics.addSessionInfo(sessionInfo);\n\n  };\n\n  var _log = function (action, variation) {\n    var data = {\n      action: action,\n      variation: variation\n    };\n    _otkanalytics.logEvent(data);\n  };\n\n  /** End Analytics */\n\n  // State vars\n  var _enabled = false;\n  var _displayed = false;\n  var _initialized = false;\n  var _controlAdded = false;\n  var _sender;\n  var _composer;\n  var _lastMessage;\n  var _newMessages;\n  var _sentMessageHistory = [];\n  var _remoteParticipant = false;\n\n  // Reference to Accelerator Pack Common Layer\n  var _accPack;\n\n  var _triggerEvent = function (event, data) {\n    _accPack && _accPack.triggerEvent(event, data);\n  };\n\n  // Private methods\n  var _escapeHtml = function (string) {\n    var charactersMap = {\n      '<': '&lt;',\n      '>': '&gt;',\n      '\"': '&quot;',\n      \"'\": '&#x27;'\n    };\n    return (string || '')\n      .toString()\n      .replace(/[<>\"']/ig, function (match) {\n        return charactersMap[match];\n      });\n  }\n\n  var renderUILayout = function () {\n    var deliveryMessage =\n      _this.options.waitingMessage || 'Messages will be delivered once your contact arrives';\n    /* eslint-disable max-len, prefer-template */\n    return [\n      '<div class=\"ots-text-chat-container\">',\n      '<div class=\"ots-text-chat\">',\n      '<div class=\"ots-messages-header ots-hidden\" id=\"chatHeader\">',\n      '<span>Chat with</span>',\n      '</div>',\n      '<div id=\"otsChatWrap\">',\n      '<div class=\"ots-messages-holder\" id=\"messagesHolder\">',\n      '<div class=\"ots-messages-alert ots-hidden\" id=\"messagesWaiting\">' + _escapeHtml(deliveryMessage) + '</div>',\n      '<div class=\"ots-message-item ots-message-sent\">',\n      '</div>',\n      '</div>',\n      '<div class=\"ots-send-message-box\">',\n      '<input type=\"text\" maxlength=' + _escapeHtml(_this.options.limitCharacterMessage) + ' class=\"ots-message-input\" placeholder=\"Enter your message here\" id=\"messageBox\">',\n      '<button class=\"ots-icon-check\" id=\"sendMessage\" type=\"submit\"></button>',\n      '<div class=\"ots-character-count\"><span><span id=\"characterCount\">0</span>/' + _escapeHtml(_this.options.limitCharacterMessage) + ' characters</span></div>',\n      '</div>',\n      '</div>',\n      '</div>',\n      '</div>'\n    ].join('\\n');\n    /* eslint-enable max-len, prefer-template */\n  };\n\n  var _shouldAppendMessage = function (data) {\n\n    if (_lastMessage) {\n      return _lastMessage.sender.id === data.sender.id && _lastMessage.sender.id === data.sender.id;\n    }\n\n    return false;\n\n  };\n\n  var _cleanComposer = function () {\n    _composer.value = '';\n    $('#characterCount').text('0');\n  };\n\n  var _getBubbleHtml = function (message) {\n    /* eslint-disable max-len, prefer-template */\n    var bubble = [\n      '<div class=\"' + _escapeHtml(message.messageClass) + '\" >',\n      '<div class=\"ots-user-name-initial\"> ' + _escapeHtml(message.username[0]) + '</div>',\n      '<div class=\"ots-item-timestamp\"> ' + _escapeHtml(message.username) + ', <span data-livestamp=\" ' + new Date(message.time) + '\" </span></div>',\n      '<div class=\"ots-item-text\">',\n      '<span> ' + _escapeHtml(message.message) + '</span>',\n      '</div>',\n      '</div>'\n    ].join('\\n');\n    /* eslint-enable max-len, prefer-template */\n    return bubble;\n  };\n\n  var _renderChatMessage = function (messageSenderId, messageSenderAlias, message, sentOn) {\n\n    var sentByClass = _sender.id === messageSenderId ?\n      'ots-message-item ots-message-sent' :\n      'ots-message-item';\n\n    var view = _getBubbleHtml({\n      username: messageSenderAlias,\n      message: message,\n      messageClass: sentByClass,\n      time: sentOn\n    });\n\n    var chatholder = $(_newMessages);\n    chatholder.append(view);\n    chatholder[0].scrollTop = chatholder[0].scrollHeight;\n\n  };\n\n  var _handleMessageSent = function (data) {\n    _cleanComposer();\n    if (_shouldAppendMessage(data)) {\n      $('.ots-item-text').last().append(['<span>', _escapeHtml(data.message), '</span>'].join(''));\n      var chatholder = $(_newMessages);\n      chatholder[0].scrollTop = chatholder[0].scrollHeight;\n    } else {\n      _renderChatMessage(_sender.id, _sender.alias, data.message, data.sentOn);\n    }\n    _lastMessage = data;\n\n    _triggerEvent('messageSent', data);\n\n  };\n\n  var _handleMessageError = function (error) {\n    console.log(error.code, error.message);\n    if (error.code === 500) {\n      var view = _.template($('#chatError').html());\n      $(_this.comms_elements.messagesView).append(view());\n    }\n    _triggerEvent('errorSendingMessage', error);\n  };\n\n  var _showWaitingMessage = function () {\n    var el = document.getElementById('messagesWaiting');\n    el && el.classList.remove('ots-hidden');\n    var parent = document.getElementById('messagesHolder');\n    parent && parent.classList.add('has-alert');\n  };\n\n  var _hideWaitingMessage = function () {\n    var el = document.getElementById('messagesWaiting');\n    el && el.classList.add('ots-hidden');\n    var parent = document.getElementById('messagesHolder');\n    parent && parent.classList.add('has-alert');\n  };\n\n  var _sendMessage = function (recipient, message) {\n\n    var deferred = new $.Deferred();\n\n    _sentMessageHistory.push({ recipient: recipient, message: message });\n    if (!_remoteParticipant) {\n      _showWaitingMessage();\n      deferred.resolve();\n    } else {\n      _hideWaitingMessage();\n    }\n\n    var messageData = {\n      text: message,\n      sender: {\n        id: _sender.id,\n        alias: _sender.alias,\n      },\n      sentOn: Date.now()\n    };\n\n    // Add SEND_MESSAGE attempt log event\n    _log(_logEventData.actionSendMessage, _logEventData.variationAttempt);\n\n    if (recipient === undefined) {\n      _session\n        .signal({\n          type: 'text-chat',\n          data: JSON.stringify(messageData)\n        }, function (error) {\n          if (error) {\n            var errorMessage = 'Error sending a message. ';\n            // Add SEND_MESSAGE failure log event\n            _log(_logEventData.actionSendMessage, _logEventData.variationFailure);\n            if (error.code === 413) {\n              errorMessage += 'The chat message is over size limit.';\n            } else {\n              if (error.code === 500) {\n                errorMessage += 'Check your network connection.';\n              }\n            }\n            deferred.reject(_.extend(_.omit(error, 'message')), {\n              message: errorMessage\n            });\n          } else {\n            console.log('Message sent');\n            // Add SEND_MESSAGE success log event\n            _log(_logEventData.actionSendMessage, _logEventData.variationSuccess);\n            deferred.resolve(messageData);\n          }\n        });\n    } else {\n      _session.signal({\n        type: 'text-chat',\n        data: JSON.stringify(messageData),\n        to: recipient\n      }, function (error) {\n        if (error) {\n          console.log('Error sending a message');\n          _log(_logEventData.actionSendMessage, _logEventData.variationFailure);\n          deferred.resolve(error);\n        } else {\n          console.log('Message sent');\n          deferred.resolve(messageData);\n          _log(_logEventData.actionSendMessage, _logEventData.variationSuccess);\n        }\n      });\n    }\n\n    return deferred.promise();\n  };\n\n  var _sendTxtMessage = function (text) {\n    if (!_.isEmpty(text)) {\n      $.when(_sendMessage(_this._remoteParticipant, text))\n        .then(function () {\n          _handleMessageSent({\n            sender: {\n              id: _sender.id,\n              alias: _sender.alias\n            },\n            message: text,\n            sentOn: Date.now()\n          });\n          if (this.futureMessageNotice) {\n            this.futureMessageNotice = false;\n          }\n        }, function (error) {\n          _handleMessageError(error);\n        });\n    }\n  };\n\n  var _setupUI = function () {\n\n    // Add INITIALIZE success log event\n    _log(_logEventData.actionInitialize, _logEventData.variationAttempt);\n\n    var parent = document.querySelector(_this.options.textChatContainer) || document.body;\n\n    var chatView = document.createElement('section');\n    chatView.innerHTML = renderUILayout();\n\n    _composer = chatView.querySelector('#messageBox');\n\n    _newMessages = chatView.querySelector('#messagesHolder');\n\n    _composer.onkeyup = function updateCharCounter() {\n      $('#characterCount').text(_composer.value.length);\n      if (_composer.value.length !== 0) {\n        $('.ots-icon-check').addClass('active');\n      } else {\n        $('.ots-icon-check').removeClass('active');\n      }\n    };\n\n    _composer.onkeydown = function controlComposerInput(event) {\n      var isEnter = (event.which === 13 || event.keyCode === 13);\n      if (!event.shiftKey && isEnter) {\n        event.preventDefault();\n        _sendTxtMessage(_composer.value);\n      }\n    };\n\n    parent.appendChild(chatView);\n\n    document.getElementById('sendMessage').onclick = function () {\n      _sendTxtMessage(_composer.value);\n    };\n    // Add INITIALIZE success log event\n    _log(_logEventData.actionInitialize, _logEventData.variationSuccess);\n  };\n\n  var _onIncomingMessage = function (signal) {\n    _log(_logEventData.actionReceiveMessage, _logEventData.variationAttempt);\n    var data = JSON.parse(signal.data);\n\n    if (_shouldAppendMessage(data)) {\n      $('.ots-item-text').last().append(['<span>', _escapeHtml(data.text), '</span>'].join(''));\n    } else {\n      _renderChatMessage(data.sender.id, data.sender.alias, data.text, data.sentOn);\n    }\n\n    _lastMessage = data;\n    _log(_logEventData.actionReceiveMessage, _logEventData.variationSuccess);\n  };\n\n  var _handleTextChat = function (event) {\n    var me = _session.connection.connectionId;\n    var from = event.from.connectionId;\n    if (from !== me) {\n      var handler = _onIncomingMessage(event);\n      if (handler && typeof handler === 'function') {\n        handler(event);\n      }\n      _triggerEvent('messageReceived', event);\n    }\n  };\n\n  var _deliverUnsentMessages = function () {\n    _sentMessageHistory.forEach(function (message) {\n      _sendMessage(message.recipient, message.message);\n    });\n    _sentMessageHistory = [];\n  };\n\n  var _initTextChat = function () {\n    _log(_logEventData.actionStart, _logEventData.variationAttempt);\n    _enabled = true;\n    _displayed = true;\n    _initialized = true;\n    _setupUI();\n    _triggerEvent('showTextChat');\n    _session.on('signal:text-chat', _handleTextChat);\n    _log(_logEventData.actionStart, _logEventData.variationSuccess);\n  };\n\n  var _showTextChat = function () {\n    _log(_logEventData.actionOpen, _logEventData.variationAttempt);\n    document.querySelector(_this.options.textChatContainer).classList.remove('ots-hidden');\n    _displayed = true;\n    _triggerEvent('showTextChat');\n\n    // Add OPEN success log event\n    _log(_logEventData.actionOpen, _logEventData.variationSuccess);\n  };\n\n  var _hideTextChat = function () {\n    _log(_logEventData.actionClose, _logEventData.variationAttempt);\n    _log(_logEventData.actionEnd, _logEventData.variationAttempt);\n    document.querySelector(_this.options.textChatContainer).classList.add('ots-hidden');\n    _displayed = false;\n    _triggerEvent('hideTextChat');\n\n    // Add CLOSE success log event\n    _log(_logEventData.actionClose, _logEventData.variationSuccess);\n    _log(_logEventData.actionEnd, _logEventData.variationSuccess);\n  };\n\n  var _appendControl = function () {\n\n    var feedControls = document.querySelector(_this.options.controlsContainer);\n\n    var el = document.createElement('div');\n    el.innerHTML = '<div class=\"ots-video-control circle text-chat enabled\" id=\"enableTextChat\"></div>';\n\n    var enableTextChat = el.firstChild;\n    feedControls.appendChild(enableTextChat);\n\n    _controlAdded = true;\n\n    enableTextChat.onclick = function () {\n\n      if (!_initialized) {\n        _initTextChat();\n      } else if (!_displayed) {\n        _showTextChat();\n      } else {\n        _hideTextChat();\n      }\n    };\n  };\n\n  var _validateOptions = function (options) {\n\n    if (!options.session) {\n      throw new Error('Text Chat Accelerator Pack requires an OpenTok session.');\n    }\n\n    // Generates a random alpha-numeric string of n length\n    var uniqueString = function (length) {\n      var len = length || 3;\n      return Math.random().toString(36).substr(2, len);\n    };\n\n    // Returns session id prepended and appended with unique strings\n    var generateUserId = function () {\n      return [uniqueString(), _session.id, uniqueString()].join('');\n    };\n\n    _session = _.property('session')(options);\n    _accPack = _.property('accPack')(options);\n\n    /**\n     * Create arbitary values for sender id and alias if not recieved\n     * in options hash.\n     */\n    _sender = _.defaults(options.sender || {}, {\n      id: generateUserId(),\n      alias: ['User', uniqueString()].join(' ')\n    });\n\n    return _.defaults(_.omit(options, ['accPack', '_sender']), {\n      limitCharacterMessage: 160,\n      controlsContainer: '#feedControls',\n      textChatContainer: '#chatContainer',\n      alwaysOpen: false,\n      appendControl: true,\n    });\n  };\n\n  var _registerEvents = function () {\n    var events = [\n      'showTextChat',\n      'hideTextChat',\n      'messageSent',\n      'errorSendingMessage',\n      'messageReceived'\n    ];\n    _accPack && _accPack.registerEvents(events);\n  };\n\n  var _handleConnectionCreated = function (event) {\n    if (event && event.connection.connectionId !== _session.connection.connectionId) {\n      _remoteParticipant = true;\n      _hideWaitingMessage();\n    }\n  };\n\n  var _handleStreamCreated = function (event) {\n    if (event && event.stream.connection.connectionId !== _session.connection.connectionId) {\n      _remoteParticipant = true;\n      _hideWaitingMessage();\n    }\n  };\n\n  var _handleStreamDestroyed = function () {\n    if (_session.streams.length() < 2) {\n      _remoteParticipant = false;\n    }\n  };\n\n  var _addEventListeners = function () {\n\n    if (_accPack) {\n      _accPack.registerEventListener('streamCreated', _handleStreamCreated);\n      _accPack.registerEventListener('streamDestroyed', _handleStreamDestroyed);\n\n      _accPack.registerEventListener('startCall', function () {\n        if (!_this.options.alwaysOpen) {\n          if (_controlAdded) {\n            document.querySelector('#enableTextChat').classList.remove('ots-hidden');\n          } else {\n            _this.options.appendControl && _appendControl()\n          }\n        }\n      });\n\n      _accPack.registerEventListener('endCall', function () {\n        if (!_this.options.alwaysOpen) {\n          document.getElementById('enableTextChat').classList.add('ots-hidden');\n          if (_displayed) {\n            _hideTextChat();\n          }\n        }\n      });\n    } else {\n      _session.on('streamCreated', _handleStreamCreated);\n      _session.on('streamDestroyed', _handleStreamDestroyed);\n    }\n\n    _session.on('connectionCreated', _handleConnectionCreated);\n\n    /**\n     * We need to check for remote participants in case we were the last party to join and\n     * the session event fired before the text chat component was initialized.\n     */\n    _handleStreamCreated();\n\n  };\n\n  // Constructor\n  var TextChatAccPack = function (options) {\n\n    // Save a reference to this\n    _this = this;\n\n    // Extend instance and set private vars\n    _this.options = _validateOptions(options);\n\n    // Init the analytics logs\n    _logAnalytics();\n\n    if (!!_.property('_this.options.limitCharacterMessage')(options)) {\n      _log(_logEventData.actionSetMaxLength, _logEventData.variationSuccess);\n    }\n\n    if (_this.options.alwaysOpen) {\n      _initTextChat();\n    }\n\n    if (_this.options.appendControl) {\n      _appendControl();\n    }\n\n    _registerEvents();\n    _addEventListeners();\n  };\n\n  TextChatAccPack.prototype = {\n    constructor: TextChatAccPack,\n    isEnabled: function () {\n      return _enabled;\n    },\n    isDisplayed: function () {\n      return _displayed;\n    },\n    showTextChat: function () {\n      _showTextChat();\n    },\n    hideTextChat: function () {\n      _hideTextChat();\n    },\n    deliverUnsentMessages: function () {\n      _deliverUnsentMessages();\n    }\n  };\n\n  if (typeof exports === 'object') {\n    module.exports = TextChatAccPack;\n  } else if (typeof define === 'function' && define.amd) {\n    define(function () {\n      return TextChatAccPack;\n    });\n  } else {\n    this.TextChatAccPack = TextChatAccPack;\n  }\n\n}.call(this));\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}